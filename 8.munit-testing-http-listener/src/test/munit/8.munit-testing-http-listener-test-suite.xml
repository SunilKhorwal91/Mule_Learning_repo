<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:munit="http://www.mulesoft.org/schema/mule/munit"
	xmlns:munit-tools="http://www.mulesoft.org/schema/mule/munit-tools" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xsi:schemaLocation="
		http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
		http://www.mulesoft.org/schema/mule/munit http://www.mulesoft.org/schema/mule/munit/current/mule-munit.xsd
		http://www.mulesoft.org/schema/mule/munit-tools  http://www.mulesoft.org/schema/mule/munit-tools/current/mule-munit-tools.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd">
	<munit:config name="8.munit-testing-http-listener-test-suite.xml" />
	<http:request-config name="HTTP_Request_configuration" doc:name="HTTP Request configuration" doc:id="1058f474-04ea-43e2-9234-bc6a40e2bf11" >
		<http:request-connection host="localhost" port="8081" />
	</http:request-config>
	<munit:test name="httpGETRequestSuccessTestCase" doc:id="22267670-6a1c-47c5-a2fc-44c3a35cfc8e" description="Test">
		<munit:enable-flow-sources >
			<munit:enable-flow-source value="getUser" />
		</munit:enable-flow-sources>
		<munit:execution >
			<http:request method="GET" doc:name="Request HTTP GET" doc:id="2043b309-964f-41cf-8e8f-6416f52d618f" config-ref="HTTP_Request_configuration" path="/getUser"/>
		</munit:execution>
		<munit:validation>
			<munit-tools:assert-that doc:name="Assert that - payload response mediatype is JSON" doc:id="861bae6a-aa01-4143-b940-2b3d9bab50f4" is="#[MunitTools::withMediaType('application/json')]" expression="#[payload]"/>
			<munit-tools:assert-that doc:name="Assert that - payload.firstName is Nelson" doc:id="aca931e0-12e8-40e4-98d4-bd08c9390461" is="#[MunitTools::equalTo('Nelson')]" expression="#[payload.firstName]"/>
			<munit-tools:assert-that doc:name="Assert that - payload.lastName is Dias" doc:id="8d6fe946-fd3a-4ec0-a0f1-f5cc892e4bbc" expression="#[payload.lastName]" is="#[MunitTools::equalTo('Dias')]"/>
		</munit:validation>
	</munit:test>
	<munit:test name="httpPOSTRequestSuccessTestCase" doc:id="420c052b-24fe-4915-8f03-1174d5e159ce">
		<munit:enable-flow-sources >
			<munit:enable-flow-source value="createNewUser" />
		</munit:enable-flow-sources>
		<munit:execution >
			<munit:set-event doc:name="Set Event - Payload With New User" doc:id="8ab6f3a7-38ec-46a3-a93b-9bcba7b91ee9" >
				<munit:payload value='#[%dw 2.0&#10;&#10;&#10;output application/json&#10;---&#10;{&#10;       "firstName": "Nelson",&#10;	   "lastName": "Dias",&#10;	   "yearBorn": "2001",&#10;	   "district": "Lisbon",&#10;	   "Gender": "Male"&#10;}]' />
			</munit:set-event>
			<http:request method="POST" doc:name="Request HTTP POST" doc:id="d2c7bf2b-c6a6-4889-a287-234144d0fd8f" config-ref="HTTP_Request_configuration" path="/createNewUser"/>
		</munit:execution>
		<munit:validation >
			<munit-tools:assert-that doc:name="Assert that - Payload Response is OK" doc:id="e7b4eb7f-b734-46f0-b1fc-ec76a6147f2d" is="#[MunitTools::containsString('Registration completed!')]" expression="#[payload]" />
		</munit:validation>
	</munit:test>
	<munit:test name="httpPOSTRequestInSuccessTestCase" doc:id="4a8c1857-7a85-4dda-8c09-564a463ad46a" >
		<munit:enable-flow-sources >
			<munit:enable-flow-source value="createNewUser" />
		</munit:enable-flow-sources>
		<munit:execution >
			<munit:set-event doc:name="Set Event - Payload With New User" doc:id="f6256aaf-bc9e-4aff-9d17-e2d2332dd04a" >
				<munit:payload value='#[%dw 2.0&#10;&#10;&#10;output application/json&#10;---&#10;{&#10;       "firstName": "Nelson",&#10;	   "lastName": "Dias",&#10;	   "yearBorn": "2019",&#10;	   "district": "Lisbon",&#10;	   "Gender": "Male"&#10;}]' />
			</munit:set-event>
			<http:request method="POST" doc:name="Request HTTP POST" doc:id="9ad38eb7-7837-45dc-8509-00a546acf119" config-ref="HTTP_Request_configuration" path="/createNewUser"/>
		</munit:execution>
		<munit:validation >
			<munit-tools:assert-that doc:name="Assert that - Payload Response is NOT OK" doc:id="b04bb0ea-b10c-4ca5-b190-f9ee185a793f" is="#[MunitTools::containsString('you are too young to register')]" expression="#[payload]"/>
		</munit:validation>
	</munit:test>


</mule>
